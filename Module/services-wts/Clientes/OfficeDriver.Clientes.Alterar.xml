<?xml version="1.0"?>
<root>
  <OBJECT NAME="Clientes">
    <METHOD NAME="Alterar" DESCRIPTION="" VERSION="32" INTFTYPE="2" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
          <GROUP NAME="Endere&#231;os"/>
          <GROUP NAME="Contatos"/>
        </GROUPS>
        <PARAM NAME="Id" FORMAT="+" SIZE="8" FLAGS="1024" PROJECTION="0" ORDER="1" FIELDLABEL="Id" CTAB="0"/>
        <PARAM NAME="Nome" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Nome" CTAB="0"/>
        <PARAM NAME="TipoPessoa" SIZE="1" FLAGS="1" DEFAULT="J" PROJECTION="0" ORDER="2" LOOKUP="list:'F','F&#237;sica';'J','Jur&#237;dica';" FIELDLABEL="Tipo de Pessoa" CTAB="0"/>
        <PARAM NAME="CPF" SIZE="14" FLAGS="1" MASK="###.###.###-##" VISIBILITYRULE="(TipoPessoa='F')" PROJECTION="0" ORDER="3" FIELDLABEL="Cpf" CTAB="0"/>
        <PARAM NAME="CNPJ" SIZE="20" FLAGS="1" MASK="###.###.###/####-##" VISIBILITYRULE="(TipoPessoa='J')" PROJECTION="0" ORDER="4" FIELDLABEL="Cnpj" CTAB="0"/>
        <PARAM NAME="Logo" FORMAT="I" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Logo" CTAB="0"/>
        <PARAM NAME="Endereco" FORMAT="R" FLAGS="1" STYLE="8" PROJECTION="0" ORDER="7" FIELDLABEL="Endere&#231;os" NESTEDNAME="OfficeDriver.Pessoas.Endereco" GROUPNAME="Endere&#231;os" CTAB="0"/>
        <PARAM NAME="Contatos" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="Contatos" NESTEDNAME="OfficeDriver.Pessoas.Contato" GROUPNAME="Contatos" CTAB="0"/>
      </PARAMS>
      <FIELDS/>
      <ACTIONSCRIPT>#CHECK("SELECT COUNT(ID) AS N FROM CLIENTES WHERE CNPJCPF=:CPF OR CNPJCPF=:CNPJ", N>0, "J&#225; existe um cliente com o CNPJ/CPF informado.");

SELECT:CLI ID FROM CLIENTES WHERE ID = :ID;
UPDATE CLIENTES SET  ID=:ID,
                     NOME=:NOME,
					 TIPOPESSOA=:TIPOPESSOA,
					 CNPJ=:CNPJ,
                     CPF=:CPF,
					 CNPJ=:CNPJ,
					 LOGO=:LOGO
WHERE (ID=:ID);

DELETE FROM ENDERECOS
WHERE TIPOPESSOA = 0 AND
      PESSOA=:ID;
INSERT INTO ENDERECOS ( TIPOPESSOA, PESSOA, CEP, LOGRADOURO, NUMERO, COMPLEMENTO, BAIRRO, ESTADO, CIDADE )
               VALUES ( 1, :CLI.ID, :ENDERECO.CEP, :ENDERECO.LOGRADOURO, :ENDERECO.NUMERO, :ENDERECO.COMPLEMENTO, :ENDERECO.BAIRRO, :ENDERECO.ESTADO, :ENDERECO.CIDADE )
               #RETURN(ID);

DELETE FROM CONTATOS
WHERE TIPOPESSOA = 0 AND
      PESSOA=:ID;
      
#EACH() CONTATOS;
  INSERT INTO CONTATOS ( TIPOPESSOA, PESSOA, NOME, TIPO, DDD, TELEFONE, EMAIL)
                 VALUES ( 1,  :CLI.ID, :CONTATOS.NOME, :CONTATOS.TIPO, :CONTATOS.DDD, :CONTATOS.TELEFONE, :CONTATOS.EMAIL)
                 #RETURN(ID);

DELETE FROM VEICULOSPESSOAS
WHERE TIPOPESSOA = 1 AND
      PESSOA=:ID;
#EACH() VEICULOS;
  INSERT INTO VEICULOSPESSOAS ( TIPOPESSOA, PESSOA, VEICULO)
                 VALUES ( 1,  :CLI.ID, :VEICULOS.ID)
                 #RETURN(ID);

DELETE FROM CLIENTESCONTRATOS
WHERE CLIENTE = :ID;

#EACH() CONTRATOS;
  INSERT INTO CLIENTESCONTRATOS ( CLIENTE, CONTRATO)
                 VALUES (:CLI.ID, :CONTRATOS.ID)
                 #RETURN(ID);

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>