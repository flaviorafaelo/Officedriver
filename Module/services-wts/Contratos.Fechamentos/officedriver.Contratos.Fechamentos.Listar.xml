<?xml version="1.0"?>
<root>
  <OBJECT NAME="Contratos.Fechamentos">
    <METHOD NAME="Listar" DESCRIPTION="Lista Fechamento de Contratos" VERSION="33" INTFTYPE="5" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="DataFechamento" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="Data fechamento" CTAB="0"/>
        <PARAM NAME="Cliente" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="1" LOOKUP="Clientes.Listar" LOOKUPKEY="Id" LOOKUPDISPLAY="Nome" LOOKUPCODE="CNPJCPF" FIELDLABEL="Cliente" CTAB="0"/>
        <PARAM NAME="Contrato" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="N&#186; Contrato" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="Id" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Id" CTAB="0"/>
        <FIELD NAME="Descricao" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="Descri&#231;&#227;o" CTAB="0"/>
        <FIELD NAME="Cliente" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="Cliente" CTAB="0"/>
        <FIELD NAME="DataBaseFechamento" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Data Base Fechamento" CTAB="0"/>
        <FIELD NAME="Status" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Status" CTAB="0"/>
        <FIELD NAME="Contrato" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Contrato" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT F.Id,
       F.Descricao,
       F.DataBaseFechamento,
       C.Nome as Cliente,
       CN.Descricao as Contrato,
       #TRANSLATE(F.Status,"0":"Aberto", "1":"Fechado") as Status
FROM Fechamentos F
INNER JOIN FechamentosContratos FC on (FC.fechamento = F.Id)
INNER JOIN Clientes C ON (C.Id = F.Cliente)
INNER JOIN Contratos CN ON (CN.Cliente = C.Id)
WHERE  F.DataBaseFechamento BETWEEN CN.DataInicio AND CN.DataTermino
  [AND  CN.NUMERO = :CONTRATO]
  [AND  C.ID = :CLIENTE]
  [AND  F.DATABASEFECHAMENTO = :DATAFECHAMENTO]
ORDER BY F.Id
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>