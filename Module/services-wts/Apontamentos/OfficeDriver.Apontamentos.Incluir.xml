<?xml version="1.0"?>
<root>
  <OBJECT NAME="Apontamentos">
    <METHOD NAME="Incluir" DESCRIPTION="" VERSION="58" INTFTYPE="1" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
          <GROUP NAME="Entrada"/>
          <GROUP NAME="Intervalo"/>
          <GROUP NAME="Saida"/>
          <GROUP NAME="Reembolsos" STYLE="1"/>
        </GROUPS>
        <PARAM NAME="OrdemServico" SIZE="50" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="O.S." CTAB="0"/>
        <PARAM NAME="Contrato" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="2" LOOKUP="CONTRATOS.LISTARPORCOOPERADO" LOOKUPKEY="Id" LOOKUPDISPLAY="Descricao" LOOKUPCODE="Numero" FIELDLABEL="Contrato" CTAB="0"/>
        <PARAM NAME="Cooperado" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="1" LOOKUP="COOPERADOS.LISTAR" LOOKUPKEY="Id" LOOKUPDISPLAY="Nome" LOOKUPCODE="Matricula" FIELDLABEL="Cooperado" CTAB="0"/>
        <PARAM NAME="Veiculo" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="3" LOOKUP="VEICULOS.LISTAR" LOOKUPKEY="Id" LOOKUPDISPLAY="Modelo" FIELDLABEL="Ve&#237;culo" CTAB="0"/>
        <PARAM NAME="DataEntrada" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Data" GROUPNAME="Entrada" CTAB="0"/>
        <PARAM NAME="HoraEntrada" SIZE="5" FLAGS="1" MASK="##:##" PROJECTION="0" ORDER="9" FIELDLABEL="Hora" GROUPNAME="Entrada" CTAB="0"/>
        <PARAM NAME="KmInicial" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="Km" GROUPNAME="Entrada" CTAB="0"/>
        <PARAM NAME="DataSaida" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="15" FIELDLABEL="Data" GROUPNAME="Saida" CTAB="0"/>
        <PARAM NAME="HoraSaida" SIZE="5" FLAGS="1" MASK="##:##" PROJECTION="0" ORDER="16" FIELDLABEL="Hora" GROUPNAME="Saida" CTAB="0"/>
        <PARAM NAME="KmFinal" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="17" FIELDLABEL="Km" GROUPNAME="Saida" CTAB="0"/>
        <PARAM NAME="IntervaloDescanso" SIZE="5" MASK="##:##" PROJECTION="0" ORDER="15" FIELDLABEL="Intervalo de Descan&#231;o" GROUPNAME="Saida" CTAB="0"/>
        <PARAM NAME="Viagem" FORMAT="B" SIZE="1" FLAGS="17" DEFAULT="FALSE" PROJECTION="0" ORDER="5" FIELDLABEL="Viagem" CTAB="0"/>
        <PARAM NAME="Observacao" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="Observacao" CTAB="0"/>
        <PARAM NAME="Reembolsos" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="19" FIELDLABEL="Reembolsos" NESTEDNAME="OfficeDriver.Apontamentos.Reembolso" GROUPNAME="Reembolsos" CTAB="0"/>
        <PARAM NAME="Fechamento" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Fechamento" CTAB="0"/>
        <PARAM NAME="InicioIntervalo" SIZE="5" FLAGS="1" MASK="##:##" PROJECTION="0" ORDER="12" FIELDLABEL="Inicio" GROUPNAME="Intervalo" CTAB="0"/>
        <PARAM NAME="FimIntervalo" SIZE="5" FLAGS="1" MASK="##:##" PROJECTION="0" ORDER="13" FIELDLABEL="Final" GROUPNAME="Intervalo" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="Id" FORMAT="+" SIZE="8" FLAGS="1024" PROJECTION="0" FIELDLABEL="Id" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>#CHECK("SELECT COUNT(*) AS N FROM Apontamentos WHERE Cooperado=:Cooperado AND DataEntrada=:DataEntrada",N>0,"Apontamento j&#225; realizado nessa data!");

INSERT:MAIN INTO Apontamentos( OrdemServico, Contrato, Cooperado, Veiculo, DataEntrada, HoraEntrada, KmInicial, DataSaida, HoraSaida, KmFinal, IntervaloDescanso, Viagem, Observacao, Entrada, Saida, InicioIntervalo, FimIntervalo)
                      VALUES ( :OrdemServico, :Contrato, :Cooperado, :Veiculo, :DataEntrada, :HoraEntrada, :KmInicial, :DataSaida, :HoraSaida, :KmFinal, :IntervaloDescanso, :Viagem, :Observacao, :DataEntrada || ' ' ||:HoraEntrada,  :DataSaida || ' ' ||:HoraSaida, :InicioIntervalo, :FimIntervalo)
                      #RETURN(Id);

#EACH() #CALL:DETALHES OFFICEDRIVER.APONTAMENTOS.Detalhar(:HoraEntrada,:HoraSaida);
  INSERT INTO ApontamentosDetalhados(Apontamento,Horario,Tempo) VALUES (:MAIN.Id, :DETALHES.Horario, :DETALHES.Tempo) #RETURN(Id);

#EACH() Reembolsos;
 INSERT INTO ApontamentosReembolsos (Apontamento,Tipo,Valor,Observacao) VALUES (:MAIN.Id,:Reembolsos.Tipo,:Reembolsos.Valor,:Reembolsos.Observacao) #RETURN(Id);

#CHECK("SELECT COUNT(*) AS N FROM Apontamentos WHERE Id=:MAIN.ID AND Saida &lt; Entrada",N>0,"A Data e Hora de Saida n&#227;o pode ser menor Data e Hora de Entrada");
#CHECK("SELECT COUNT(*) AS N FROM Apontamentos WHERE Id=:MAIN.ID AND KmFinal &lt; KmInicial",N>0,"O KM Final n&#227;o pode ser menor que o KM Inicial");

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>